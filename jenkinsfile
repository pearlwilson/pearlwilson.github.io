pipeline {
    agent any
    tools {
        nodejs 'nodejs'
    }
    stages {
        stage('cleanup') {
            steps {
                bat 'cd src && rmdir /s/q "hello-world-app" '     
            }
        }                
        stage('Install') {
            steps {
                bat 'cd src && npx create-react-app hello-world-app'     
            }
        }
        stage('Build') {
            steps {
                bat 'cd src/hello-world-app && npm run build'    
            }
        }
        stage('Dockerize and Run') {
            steps {
                bat '''
                    docker build -t my_nginx_image .
                    docker stop 32e7079ef0c03c78170b96b8f020007243506a0a3dca7e178ab26e71e4994ff9 || true
                    docker run -d -p 8081:80 -v C:\ProgramData\Jenkins\.jenkins\workspace\uibuild\src\hello-world-app\build:/usr/share/nginx/html my_nginx_image 
                '''
            }
        }
    }
}
